# ============================================================
# üîê SECRETS
# ============================================================
secret:
  jwt:
    secretRef: "supabase-secrets"
    secretRefKey:
      anonKey: anon-key
      serviceKey: service-role-key
      secret: jwt-secret
  
  smtp:
    secretRef: "supabase-secrets"
    secretRefKey:
      username: smtp-username
      password: smtp-password

  dashboard:
    secretRef: "supabase-secrets"
    secretRefKey:
      username: dashboard-username
      password: dashboard-password
      openAiApiKey: openai-api-key

  db:
    database: "postgres"
    secretRef: "supabase-secrets"
    secretRefKey:
      password: postgres-password

  analytics:
    secretRef: "supabase-secrets"
    secretRefKey:
      publicAccessToken: logflare-public-access-token
      privateAccessToken: logflare-private-access-token

  realtime:
    secretRef: "supabase-secrets"
    secretRefKey:
      secretKeyBase: realtime-secret

  meta:
    secretRef: "supabase-secrets"
    secretRefKey:
      cryptoKey: meta-crypto-key

  supavisor:
    secretRef: "supabase-secrets"
    secretRefKey:
      secretKeyBase: supavisor-secret-key-base
      vaultEncKey: supavisor-vault-enc-key
# ============================================================
# üóÑÔ∏è DATABASE
# ============================================================
db:
  enabled: true
  image:
    tag: "15.8.1.085"
  persistence:
    enabled: true
    storageClass: hcloud-volumes
    size: 20Gi

# ============================================================
# üñ•Ô∏è STUDIO
# ============================================================
studio:
  image:
    tag: "2025.11.10-sha-5291fe3"
  environment:
    DEFAULT_ORGANIZATION_NAME: "Recomend"
    DEFAULT_PROJECT_NAME: "Production"
    SUPABASE_PUBLIC_URL: "https://supabase.recomend.app"
    NEXT_PUBLIC_ENABLE_LOGS: true

# ============================================================
# üîê AUTH
# ============================================================
auth:
  image:
    tag: "v2.182.1"
  environment:
    API_EXTERNAL_URL: "https://supabase.recomend.app"
    GOTRUE_SITE_URL: "https://recomend.app"
    GOTRUE_EXTERNAL_EMAIL_ENABLED: "false"
    GOTRUE_MAILER_AUTOCONFIRM: "false"

# ============================================================
# REST / REALTIME / META
# ============================================================
rest:
  image:
    tag: "v13.0.7"

realtime:
  image:
    tag: "v2.63.0"

meta:
  image:
    tag: "v0.93.1"

# ============================================================
# STORAGE + IMGPROXY (file system local ou R2)
# ============================================================
storage:
  image:
    tag: "v1.29.0"
  persistence:
    enabled: true
    storageClass: hcloud-volumes
    size: 20Gi

imgproxy:
  image:
    tag: "v3.8.0"

# ============================================================
# üß© KONG (Ingress par Traefik, pas NGINX)
# ============================================================
kong:
  image:
    repository: kong
    tag: "2.8.1"

  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    tls:
      - secretName: supabase-tls
        hosts:
          - supabase.recomend.app
    hosts:
      - host: supabase.recomend.app
        paths:
          - path: /
            pathType: Prefix

# ============================================================
# ANALYTICS / VECTOR
# ============================================================
analytics:
  image:
    tag: "1.22.6"

vector:
  image:
    tag: "0.28.1-alpine"
  volumeMounts:
    - name: pod-logs
      mountPath: /var/log/pods
  volumes:
    - name: pod-logs
      hostPath:
        path: /var/log/pods

# ============================================================
# EDGE FUNCTIONS
# ============================================================
functions:
  image:
    tag: "v1.68.4"

# ============================================================
# üß† SUPAVISOR (pooler)
# ============================================================
supavisor:
  enabled: true
  image:
    tag: "2.7.4"
  service:
    port: 5432
    proxyPort: 6543
    apiPort: 4000
  environment:
    CLUSTER_POSTGRES: true
    REGION: "local"
    ERL_AFLAGS: "-proto_dist inet_tcp"
    POOLER_TENANT_ID: "recomend"
    POOLER_DEFAULT_POOL_SIZE: 15
    POOLER_MAX_CLIENT_CONN: 200
    POOLER_POOL_MODE: "transaction"
    DB_POOL_SIZE: 15
